# 工作流文档（模板与案例）

本文面向日常使用，统一说明：

- 工作流在实际任务中的用法
- 连接与引用的区别
- 全部内置模板的触发与执行顺序

---

## 1. 案例速览：社区自动发帖与巡检

这是一个典型“周期执行 + 状态跟踪”场景：

- 目标：定期让 AI 执行发帖动作，并持续关注动态
- 约束：平台有发帖频率限制（例如每 30 分钟一次）
- 方案：改为工作流调度，不再每次手动发送“继续”

### 案例截图

![workflow-case-01|225x500, 50%](/manuals/assets/workflow/01.png)

![workflow-case-02|225x500, 50%](/manuals/assets/workflow/02.png)
![workflow-case-03|225x500, 50%](/manuals/assets/workflow/03.png)

![workflow-case-04|225x500,50%](/manuals/assets/workflow/04.png)
![workflow-case-05|225x500, 50%](/manuals/assets/workflow/05.png)

![workflow-case-06|225x500, 50%](/manuals/assets/workflow/06.png)
![workflow-case-07|225x500, 50%](/manuals/assets/workflow/07.png)

![workflow-case-08|225x500, 50%](/manuals/assets/workflow/08.png)
![workflow-case-09|225x500, 50%](/manuals/assets/workflow/09.png)

### 案例中的实际操作要点

- 首次由 AI 自动生成流程后，节点可能会叠在一起，需要手动整理布局。
- 某些情况下，创建后列表不会即时刷新，重新进入应用可看到最新结果。
- 在 `工作流 > 编辑工作流` 可启用或停用流程。
- 已添加节点可通过长按进入编辑。
- 此类流程可在普通权限配置下运行。

---

## 2. 核心概念

## 2.1 连接

连接用于定义“流程怎么走”：

- 先后顺序（A 之后执行 B）
- 分支路径（满足什么条件时走哪条线）

常见分支条件：

- `on_success`：上一步成功后进入
- `on_error`：上一步失败后进入
- `true` / `false`：按判断结果分流
- 自定义正则：按文本匹配分流

## 2.2 引用

引用用于定义“参数从哪里来”：

- 下游节点参数不写死
- 直接取上游节点的输出

常见场景：

- 提取节点拿到访问键/验证码
- 下一步节点直接引用该结果执行

## 2.3 连接与引用怎么配合

- 流程控制：靠连接
- 数据传递：靠引用
- 稳定流程：连接与引用同时使用

---

## 3. 执行机制（用户视角）

一次工作流通常按以下节奏运行：

1. 触发器启动
2. 节点按依赖关系执行
3. 每个节点产生状态（运行中/成功/跳过/失败）
4. 下游节点根据连接条件决定是否继续

常见状态解释：

- **成功**：本节点执行完成并产出结果
- **跳过**：当前分支条件不满足
- **失败**：执行报错或条件无法满足

排查顺序建议：

1. 看上游输出是否符合预期
2. 看连接条件是否写对
3. 看引用是否指向正确节点
4. 看是否进入了预期分支

---

## 4. 全部内置模板（8 个）

以下均按“触发方式 + 连接顺序”说明。

## 模板 1：Intent 触发对话并回传结果

**触发方式**
- 外部广播触发

**连接顺序**
- 接收触发
→ 启动对话服务
→ 新建会话
→ 提取触发消息
→ 发送给 AI
→ 停止对话服务
→ 回传结果广播
→ 清理虚拟显示

**适用场景**
- 外部自动化系统下发任务，AI处理后回传结果。

---

## 模板 2：手动对话链路

**触发方式**
- 手动触发

**连接顺序**
- 手动触发
→ 启动对话服务
→ 新建会话
→ 发送消息
→ 停止对话服务
→ 清理虚拟显示

**适用场景**
- 快速验证“对话类自动执行”主链路。

---

## 模板 3：条件分支网页流程

**触发方式**
- 手动触发

**连接顺序**
- 手动触发
→ 访问网页 A
→ 提取关键信息
→ 条件判断
→（真）跟进页面内链接
→（假）访问备用网页 B

**适用场景**
- 网页内容命中后执行不同处理路径。

---

## 模板 4：逻辑 AND 分支流程

**触发方式**
- 手动触发

**连接顺序**
- 手动触发
→ 访问网页
→ 条件 A
→ 条件 B
→ 逻辑汇总（AND）
→（真）主动作
→（假）备用动作

**适用场景**
- 必须同时满足多个条件才继续执行。

---

## 模板 5：逻辑 OR 分支流程

**触发方式**
- 手动触发

**连接顺序**
- 手动触发
→ 访问网页
→ 条件 A
→ 条件 B
→ 逻辑汇总（OR）
→（真）主动作
→（假）备用动作

**适用场景**
- 任一条件满足即可继续。

---

## 模板 6：提取/运算演示流程

**触发方式**
- 手动触发

**主链顺序**
- 手动触发
→ 生成数值/文本
→ 拼接
→ 截取

**分支顺序**
- 数值比较
→（真）展示结果

**适用场景**
- 训练“生成-加工-判断-展示”的数据流水线。

---

## 模板 7：成功/失败分支骨架

**触发方式**
- 手动触发

**连接顺序**
- 手动触发
→ 主动作
→（成功）成功分支
→（失败）失败分支

**适用场景**
- 给关键动作加标准异常兜底结构。

---

## 模板 8：语音触发启动对话

**触发方式**
- 语音关键词触发

**连接顺序**
- 语音命中
→ 启动对话服务

**适用场景**
- 语音唤起执行，无需手动点击。

---

## 5. 选型建议

- 快速验证链路：手动对话模板
- 网页巡检与分流：条件分支模板
- 多条件决策：AND / OR 模板
- 数据加工：提取/运算模板
- 稳定性优先：成功/失败骨架模板
- 外部系统联动：Intent 模板
- 语音入口：语音触发模板

---

## 6. 编辑建议

- 先跑通主链，再加分支。
- 先加连接，再加引用。
- 每个关键节点保留可观察结果，方便排查。
- 对关键动作增加 `on_error` 兜底，避免流程硬中断。

---

## 7. 与 AI 协作修改流程（推荐写法）

```txt
请基于“条件分支网页流程”模板修改：
- 保持触发和主链顺序不变
- 只替换条件判断内容和失败分支目标
- 最后用步骤箭头复述最终连接顺序
```

这类指令有助于减少误改范围。