import{u as T,a as _,r as n,j as e,b,e as v,h as E,T as k,B as C}from"./index-CNiiDabJ.js";import{I as h}from"./index-BKhVE0s5.js";import{A as I}from"./index-CpLjwh2_.js";import"./EyeOutlined-C1yebn_W.js";const{Content:U}=b,{Title:L,Paragraph:O}=k,m={adminToken:"operit_submission_admin_token",loginUsername:"operit_submission_admin_login_username"},B="https://api.aaswordsman.org",J=({language:x})=>{const s=x==="zh",y=T(),c=_(),S=n.useMemo(()=>{const a=new URLSearchParams(c.search||"").get("next")||"/operit-submission-admin";return a.startsWith("/")?a:"/operit-submission-admin"},[c.search]),[r,f]=n.useState(()=>localStorage.getItem(m.loginUsername)||""),[i,w]=n.useState(""),[d,l]=n.useState(null),[j,p]=n.useState(!1),u=async()=>{if(!r.trim()||!i.trim()){l(s?"请输入用户名和密码":"Username and password are required");return}p(!0),l(null);try{const t=await fetch(`${B}/api/admin/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r.trim(),password:i})}),a=await t.text();let o=null;try{o=a?JSON.parse(a):null}catch{o=null}if(!t.ok){const P=o?.error;throw new Error(P||t.statusText||"login_failed")}const g=String(o?.token||"");if(!g)throw new Error("token_missing");localStorage.setItem(m.adminToken,g),localStorage.setItem(m.loginUsername,r.trim()),y(S,{replace:!0})}catch(t){l(t.message||(s?"登录失败":"Login failed"))}finally{p(!1)}};return e.jsx("main",{style:{paddingTop:88,paddingBottom:48},children:e.jsx(U,{style:{maxWidth:520,margin:"0 auto",padding:"0 24px"},children:e.jsx(v,{children:e.jsxs(E,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(L,{level:2,style:{marginBottom:8},children:s?"Operit 登录":"Operit Login"}),e.jsx(O,{type:"secondary",style:{marginBottom:0},children:s?"统一登录入口（后续可扩展普通用户与管理员）。":"Unified sign-in entry (extensible for users and admins)."})]}),e.jsx(h,{value:r,onChange:t=>f(t.target.value),placeholder:s?"用户名":"Username",autoComplete:"username"}),e.jsx(h.Password,{value:i,onChange:t=>w(t.target.value),onPressEnter:u,placeholder:s?"密码":"Password",autoComplete:"current-password"}),e.jsx(C,{type:"primary",loading:j,onClick:u,children:s?"登录":"Sign In"}),d&&e.jsx(I,{type:"error",showIcon:!0,message:s?"登录失败":"Sign-in Failed",description:d})]})})})})};export{J as default};
