import{r as o,I as U,ao as Wt,j as r,f as Gt,h as _,al as R,B as j,d as pe,C as H,T as Lt,t as Kt,a as Xt,u as Qt,b as Jt,e as ge,S as Yt}from"./index-BCZOQpt-.js";import{T as Zt}from"./TurnstileWidget-BNwIXXOB.js";import{I as xt,M as er,r as tr,a as It,b as At,c as Rt,h as rr,v as nr,u as sr,d as ar}from"./remarkDetails-D9nHR-jq.js";import{a as or,R as ir}from"./CheckCircleOutlined-CnsCABmx.js";import{I as Me}from"./index-5-sWZ2oa.js";import{s as cr,g as lr,a as dr,b as ur,c as hr,d as mr,e as yt,L as Ge,f as fr,h as jt}from"./operitLocalStore-DYbTIG0F.js";import{s as N}from"./index-DkIKjxuz.js";import{A as ue}from"./index-ays6uG_w.js";import{T as Ke,S as gr}from"./index-B0bki4ze.js";import{S as vt}from"./index-DEUYc-JY.js";import"./EyeOutlined-DyLgew2v.js";import"./addEventListener-CHd5Yb_v.js";var pr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"};function Je(){return Je=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Je.apply(this,arguments)}const br=(t,e)=>o.createElement(U,Je({},t,{ref:e,icon:pr})),xr=o.forwardRef(br);var yr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"};function Ye(){return Ye=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Ye.apply(this,arguments)}const jr=(t,e)=>o.createElement(U,Ye({},t,{ref:e,icon:yr})),vr=o.forwardRef(jr);var wr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"};function Ze(){return Ze=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Ze.apply(this,arguments)}const $r=(t,e)=>o.createElement(U,Ze({},t,{ref:e,icon:wr})),kr=o.forwardRef($r);function et(){return et=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},et.apply(this,arguments)}const Cr=(t,e)=>o.createElement(U,et({},t,{ref:e,icon:Wt})),Sr=o.forwardRef(Cr);var Or={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 416H616c-4.4 0-8 3.6-8 8v112c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-56h60v320h-46c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h164c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8h-46V480h60v56c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V424c0-4.4-3.6-8-8-8zM656 296V168c0-4.4-3.6-8-8-8H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8z"}}]},name:"font-size",theme:"outlined"};function tt(){return tt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},tt.apply(this,arguments)}const Er=(t,e)=>o.createElement(U,tt({},t,{ref:e,icon:Or})),Xe=o.forwardRef(Er);var Tr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"italic",theme:"outlined"};function rt(){return rt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},rt.apply(this,arguments)}const _r=(t,e)=>o.createElement(U,rt({},t,{ref:e,icon:Tr})),Lr=o.forwardRef(_r);var Ir={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function nt(){return nt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},nt.apply(this,arguments)}const Ar=(t,e)=>o.createElement(U,nt({},t,{ref:e,icon:Ir})),Rr=o.forwardRef(Ar);var Mr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 760H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-568H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM216 712H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h72.4v20.5h-35.7c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h35.7V838H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4V716c0-2.2-1.8-4-4-4zM100 188h38v120c0 2.2 1.8 4 4 4h40c2.2 0 4-1.8 4-4V152c0-4.4-3.6-8-8-8h-78c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4zm116 240H100c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4h68.4l-70.3 77.7a8.3 8.3 0 00-2.1 5.4V592c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4v-36c0-2.2-1.8-4-4-4h-68.4l70.3-77.7a8.3 8.3 0 002.1-5.4V432c0-2.2-1.8-4-4-4z"}}]},name:"ordered-list",theme:"outlined"};function st(){return st=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},st.apply(this,arguments)}const zr=(t,e)=>o.createElement(U,st({},t,{ref:e,icon:Mr})),Hr=o.forwardRef(zr);var Br={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2zM304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z"}}]},name:"picture",theme:"outlined"};function at(){return at=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},at.apply(this,arguments)}const Nr=(t,e)=>o.createElement(U,at({},t,{ref:e,icon:Br})),Dr=o.forwardRef(Nr);var Pr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M952 474H569.9c-10-2-20.5-4-31.6-6-15.9-2.9-22.2-4.1-30.8-5.8-51.3-10-82.2-20-106.8-34.2-35.1-20.5-52.2-48.3-52.2-85.1 0-37 15.2-67.7 44-89 28.4-21 68.8-32.1 116.8-32.1 54.8 0 97.1 14.4 125.8 42.8 14.6 14.4 25.3 32.1 31.8 52.6 1.3 4.1 2.8 10 4.3 17.8.9 4.8 5.2 8.2 9.9 8.2h72.8c5.6 0 10.1-4.6 10.1-10.1v-1c-.7-6.8-1.3-12.1-2-16-7.3-43.5-28-81.7-59.7-110.3-44.4-40.5-109.7-61.8-188.7-61.8-72.3 0-137.4 18.1-183.3 50.9-25.6 18.4-45.4 41.2-58.6 67.7-13.5 27.1-20.3 58.4-20.3 92.9 0 29.5 5.7 54.5 17.3 76.5 8.3 15.7 19.6 29.5 34.1 42H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h433.2c2.1.4 3.9.8 5.9 1.2 30.9 6.2 49.5 10.4 66.6 15.2 23 6.5 40.6 13.3 55.2 21.5 35.8 20.2 53.3 49.2 53.3 89 0 35.3-15.5 66.8-43.6 88.8-30.5 23.9-75.6 36.4-130.5 36.4-43.7 0-80.7-8.5-110.2-25-29.1-16.3-49.1-39.8-59.7-69.5-.8-2.2-1.7-5.2-2.7-9-1.2-4.4-5.3-7.5-9.7-7.5h-79.7c-5.6 0-10.1 4.6-10.1 10.1v1c.2 2.3.4 4.2.6 5.7 6.5 48.8 30.3 88.8 70.7 118.8 47.1 34.8 113.4 53.2 191.8 53.2 84.2 0 154.8-19.8 204.2-57.3 25-18.9 44.2-42.2 57.1-69 13-27.1 19.7-57.9 19.7-91.5 0-31.8-5.8-58.4-17.8-81.4-5.8-11.2-13.1-21.5-21.8-30.8H952c4.4 0 8-3.6 8-8v-60a8 8 0 00-8-7.9z"}}]},name:"strikethrough",theme:"outlined"};function ot(){return ot=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},ot.apply(this,arguments)}const Vr=(t,e)=>o.createElement(U,ot({},t,{ref:e,icon:Pr})),Ur=o.forwardRef(Vr);var Fr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"};function it(){return it=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},it.apply(this,arguments)}const qr=(t,e)=>o.createElement(U,it({},t,{ref:e,icon:Fr})),Wr=o.forwardRef(qr),Gr=nr,Kr=t=>t.startsWith("/")&&!t.startsWith("//")?`${"./".endsWith("/")?"./".slice(0,-1):"./"}${t}`:t,Xr=({content:t,resolveImageUrl:e})=>r.jsx("div",{className:"markdown-body",children:r.jsx(xt.PreviewGroup,{children:r.jsx(er,{remarkPlugins:[It,At,Rt],rehypePlugins:[tr],urlTransform:Kr,components:{code({inline:s,className:n,children:c,style:a,...l}){const h=/language-(\w+)/.exec(n||"");return!s&&h?r.jsx(rr,{style:Gr,language:h[1],PreTag:"div",...l,children:String(c).replace(/\n$/,"")}):r.jsx("code",{className:n,...l,children:c})},img:({node:s,onClick:n,...c})=>{const a=typeof c.src=="string"?c.src:"",l=a&&e?e(a):a;return r.jsx(xt,{...c,src:l||c.src})}},children:t})})}),Qr=t=>t.replace(/\r\n?/g,`
`),$e=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),ke=t=>$e(t).replace(/`/g,"&#96;"),dt=(t,e)=>{if(!t)return"";const c=new DOMParser().parseFromString(`<div>${t}</div>`,"text/html").body.firstElementChild;return c?(c.querySelectorAll("img").forEach(l=>{const h=l.getAttribute("src")||"";if(!h)return;l.setAttribute("data-operit-src",h);const $=e?.resolveImageUrl?.(h)||h;l.setAttribute("src",$)}),c.innerHTML):""},Jr=t=>`h${Number.isFinite(t)?Math.min(6,Math.max(1,t)):1}`,be=(t,e)=>{switch(t.type){case"text":return $e(t.value||"");case"inlineCode":return`<code>${$e(t.value||"")}</code>`;case"emphasis":return`<em>${(t.children||[]).map(s=>be(s,e)).join("")}</em>`;case"strong":return`<strong>${(t.children||[]).map(s=>be(s,e)).join("")}</strong>`;case"delete":return`<del>${(t.children||[]).map(s=>be(s,e)).join("")}</del>`;case"link":{const s=t.url||"",n=(t.children||[]).map(c=>be(c,e)).join("")||$e(s);return`<a href="${ke(s)}">${n}</a>`}case"image":return tn(t.alt||"",t.url||"",e);case"break":return"<br />";case"html":return dt(t.value||"",e);default:return""}},Ce=(t,e)=>t.map(s=>be(s,e)).join(""),Yr=(t,e)=>{const s=t.children||[];if(!s.length)return"";const n=[];for(const c of s){if(c.type==="paragraph"){n.push(Ce(c.children||[],e));continue}if(c.type==="list"){n.push(ze(c,e));continue}if(c.type==="html"){n.push(dt(c.value||"",e));continue}n.push(ze(c,e))}return n.join("")},Zr=(t,e)=>(t.children||[]).map(n=>`<td>${Ce(n.children||[],e)}</td>`).join(""),ze=(t,e)=>{switch(t.type){case"paragraph":{const s=t.children||[],n=s.filter(l=>l.type==="image"),c=s.filter(l=>l.type!=="text"?!0:(l.value||"").trim().length>0);if(n.length>1&&n.length===c.length)return`<div class="image-gallery">${n.map(h=>`<div class="image-container">${be(h,e)}</div>`).join("")}</div>`;const a=Ce(s,e);return a.trim()?n.length===1&&n.length===c.length?`<p class="paragraph-with-image">${a}</p>`:`<p>${a}</p>`:""}case"heading":{const s=Jr(t.depth||1),n=Ce(t.children||[],e);return`<${s}>${n}</${s}>`}case"blockquote":return`<blockquote>${(t.children||[]).map(n=>ze(n,e)).join("")||"<p><br /></p>"}</blockquote>`;case"code":return`<pre><code${t.lang?` class="language-${ke(t.lang)}"`:""}>${$e(t.value||"")}</code></pre>`;case"list":{const s=t.ordered?"ol":"ul",n=(t.children||[]).map(c=>`<li>${Yr(c,e)}</li>`).join("");return`<${s}>${n}</${s}>`}case"thematicBreak":return"<hr />";case"table":{const s=t.children||[];if(!s.length)return"";const c=(s[0].children||[]).map(h=>`<th>${Ce(h.children||[],e)}</th>`).join(""),a=s.slice(1).map(h=>`<tr>${Zr(h,e)}</tr>`).join(""),l=a?`<tbody>${a}</tbody>`:"";return`<table><thead><tr>${c}</tr></thead>${l}</table>`}case"html":return dt(t.value||"",e);default:return""}},en=(t,e)=>{const s=Qr(t||"");if(!s.trim())return"";const n=sr().use(ar).use(It).use(At).use(Rt),c=n.parse(s);return(n.runSync(c).children||[]).map(l=>ze(l,e)).join("")},tn=(t,e,s)=>{const n=s?.resolveImageUrl?.(e)||e;return`<img alt="${ke(t)}" src="${ke(n)}" data-operit-src="${ke(e)}" />`},wt=(t,e)=>en(t,e),Se=t=>t.replace(/\u00A0/g," "),X=t=>t.map(e=>{if(e.nodeType===Node.TEXT_NODE)return Se(e.textContent||"").replace(/\s+/g," ");if(e.nodeType!==Node.ELEMENT_NODE)return"";const s=e,n=s.tagName.toLowerCase();if(n==="br")return`
`;if(n==="strong"||n==="b")return`**${X(Array.from(s.childNodes))}**`;if(n==="em"||n==="i")return`*${X(Array.from(s.childNodes))}*`;if(n==="del"||n==="s"||n==="strike")return`~~${X(Array.from(s.childNodes))}~~`;if(n==="code")return s.parentElement?.tagName.toLowerCase()==="pre"?Se(s.textContent||""):`\`${Se(s.textContent||"")}\``;if(n==="a"){const c=s.getAttribute("href")||"";return`[${X(Array.from(s.childNodes)).trim()||c}](${c})`}if(n==="img"){const c=s.getAttribute("data-operit-src")||s.getAttribute("src")||"";return`![${s.getAttribute("alt")||""}](${c})`}if(n==="input"){const c=s;if(c.type==="checkbox")return c.checked?"[x]":"[ ]"}return X(Array.from(s.childNodes))}).join(""),ct=(t,e,s=0)=>{const n=[],c=Array.from(t.children).filter(l=>l.tagName.toLowerCase()==="li");let a=1;return c.forEach(l=>{const h=Array.from(l.children).filter(L=>{const g=L.tagName.toLowerCase();return g==="ul"||g==="ol"}),$=l.cloneNode(!0);Array.from($.children).forEach(L=>{const g=L.tagName.toLowerCase();(g==="ul"||g==="ol")&&L.remove()});const Q=$.querySelector('input[type="checkbox"]'),ne=Q?`${Q.checked?"[x]":"[ ]"} `:"";Q&&Q.remove();const D=e?`${a}.`:"-",J="  ".repeat(s),k=X(Array.from($.childNodes)).trim();n.push(`${J}${D} ${ne}${k}`.trimEnd()),h.forEach(L=>{const g=L.tagName.toLowerCase()==="ol",F=ct(L,g,s+1);F&&n.push(F)}),a+=1}),n.join(`
`)},rn=t=>{const e=Array.from(t.querySelectorAll("tr")).map(l=>Array.from(l.querySelectorAll("th, td")).map($=>X(Array.from($.childNodes)).trim().replace(/\|/g,"\\|"))).filter(l=>l.length>0);if(!e.length)return"";const s=e[0],n=e.slice(1),c=s.map(()=>"---");return[`| ${s.join(" | ")} |`,`| ${c.join(" | ")} |`,...n.map(l=>`| ${l.join(" | ")} |`)].join(`
`)},lt=t=>t.map(e=>{if(e.nodeType===Node.TEXT_NODE){const a=Se(e.textContent||"").trim();return a?`${a}

`:""}if(e.nodeType!==Node.ELEMENT_NODE)return"";const s=e,n=s.tagName.toLowerCase();if(n==="p"){const a=X(Array.from(s.childNodes)).trim();return a?`${a}

`:""}if(/^h[1-6]$/.test(n)){const a=Number(n[1]),l=X(Array.from(s.childNodes)).trim();return l?`${"#".repeat(a)} ${l}

`:""}if(n==="blockquote"){const a=lt(Array.from(s.childNodes)).trim();return a?`${a.split(`
`).map(h=>h?`> ${h}`:">").join(`
`)}

`:""}if(n==="pre"){const a=s.querySelector("code"),l=Se(a?.textContent||s.textContent||"").replace(/\n$/,""),h=a?.getAttribute("class")||"";return`\`\`\`${/language-([\w-]+)/.exec(h)?.[1]||""}
${l}
\`\`\`

`}if(n==="ul"){const a=ct(s,!1);return a?`${a}

`:""}if(n==="ol"){const a=ct(s,!0);return a?`${a}

`:""}if(n==="table"){const a=rn(s);return a?`${a}

`:""}if(n==="hr")return`---

`;if(n==="img"){const a=s.getAttribute("data-operit-src")||s.getAttribute("src")||"";return`![${s.getAttribute("alt")||""}](${a})

`}if(n==="details"){const a=s.querySelector(":scope > summary")?.textContent?.trim()||"",l=s.querySelector(":scope > .markdown-details-content"),h=l?lt(Array.from(l.childNodes)).trim():"",$=h?`
${h}
`:`
`;return`[details="${a}"]${$}[/details]

`}if(n==="br")return`
`;const c=X(Array.from(s.childNodes)).trim();return c?`${c}

`:""}).join(""),$t=t=>{const n=new DOMParser().parseFromString(`<div>${t}</div>`,"text/html").body.firstElementChild;return n?lt(Array.from(n.childNodes)).replace(/\n{3,}/g,`

`).trim():""},{Text:nn}=Lt,kt=t=>t.replace(/\r\n?/g,`
`).replace(/\u00A0/g," ").trim(),Ct=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),Qe="operit-local://pending",sn=Gt.forwardRef(({value:t,onChange:e,placeholder:s,mode:n,view:c,fontSize:a,labels:l,onInsertImage:h,resolveImageUrl:$},Q)=>{const ne=o.useRef(null),D=o.useRef(null),J=o.useRef(null),k=o.useRef(!1),L=o.useRef(!1),g=o.useCallback(()=>ne.current?.resizableTextArea?.textArea,[]),F=o.useCallback(()=>n==="visual"?D.current:g(),[n,g]),q=o.useCallback(d=>{const u=d||D.current;if(!u)return;const m=$t(u.innerHTML);!m.trim()&&t.trim()&&!u.isConnected||(L.current=!0,e(m),requestAnimationFrame(()=>{L.current=!1}))},[e,t]),W=o.useCallback(d=>{const u=D.current;if(!u)return;u.focus();const m=window.getSelection();if(!m||m.rangeCount===0){u.insertAdjacentHTML("beforeend",d),q();return}const C=m.getRangeAt(0);if(!u.contains(C.commonAncestorContainer)){u.insertAdjacentHTML("beforeend",d),q();return}C.deleteContents();const v=document.createElement("template");v.innerHTML=d;const y=v.content,O=y.lastChild;if(C.insertNode(y),O){const z=document.createRange();z.setStartAfter(O),z.collapse(!0),m.removeAllRanges(),m.addRange(z)}q()},[q]),T=o.useCallback((d,u)=>{const m=D.current;m&&(m.focus(),document.execCommand(d,!1,u),q())},[q]),Y=o.useCallback((d,u,m,C,v)=>{const y=g();if(!y){const O=`${t.slice(0,u)}${d}${t.slice(m)}`;e(O);return}y.focus(),y.setRangeText(d,u,m,"end"),y.setSelectionRange(C,v),y.dispatchEvent(new Event("input",{bubbles:!0}))},[t,e,g]),w=o.useCallback((d,u,m)=>{const C=g(),v=C?.selectionStart??t.length,y=C?.selectionEnd??t.length,O=t.slice(0,v),ae=t.slice(v,y)||m,te=O.length+d.length,oe=te+ae.length,re=`${d}${ae}${u}`;Y(re,v,y,te,oe)},[t,Y,g]),P=o.useCallback((d,u)=>{const m=g(),C=m?.selectionStart??t.length,v=m?.selectionEnd??t.length,y=t.lastIndexOf(`
`,Math.max(0,C-1))+1,O=t.indexOf(`
`,v),z=O===-1?t.length:O,oe=t.slice(y,z).split(`
`).map((fe,De)=>{if(u){const we=fe.replace(/^\d+\.\s+/,"");return`${De+1}. ${we}`}return`${d}${fe}`}).join(`
`),re=y,Te=y+oe.length;Y(oe,y,z,re,Te)},[t,Y,g]),M=o.useCallback(()=>{w("```\n","\n```","code")},[w]);o.useEffect(()=>{if(n!=="visual")return;const d=D.current;if(!d||L.current)return;const u=kt($t(d.innerHTML)),m=kt(t);u!==m&&(d.innerHTML=wt(t,{resolveImageUrl:$}))},[n,c,t,$]),o.useImperativeHandle(Q,()=>({insertText:d=>{if(n==="visual"){const y=wt(d,{resolveImageUrl:$})||`<p>${Ct(d).replace(/\n/g,"<br />")}</p>`;W(y);return}const u=g(),m=u?.selectionStart??t.length,C=u?.selectionEnd??t.length,v=m+d.length;Y(d,m,C,v,v)}}),[n,t,Y,W,g,$]);const se={height:"70vh",minHeight:360,maxHeight:"70vh",overflowY:"auto"},he=o.useCallback(d=>{if(c!=="split"||k.current)return;const u=F(),m=J.current;if(!u||!m)return;const C=d==="editor"?u:m,v=d==="editor"?m:u,y=C.scrollHeight-C.clientHeight,O=v.scrollHeight-v.clientHeight;if(y<=0||O<=0)return;const z=C.scrollTop/y;k.current=!0,v.scrollTop=z*O,requestAnimationFrame(()=>{k.current=!1})},[c,F]),ye=o.useCallback(()=>{W('<ul><li><input type="checkbox" disabled /> item</li></ul>')},[W]),Oe=o.useCallback(()=>{if(!!window.getSelection()?.toString().trim()){T("createLink","url");return}W('<a href="url">text</a>')},[W,T]),Z=o.useCallback(()=>{W(`<img src="${Qe}" data-operit-src="${Qe}" alt="image" />`)},[W]),He=o.useCallback(()=>{const d=window.getSelection()?.toString()||"code";T("insertHTML",`<code>${Ct(d)}</code>`)},[T]),Ee=o.useCallback(()=>{T("insertHTML","<pre><code>code</code></pre>")},[T]),je=o.useCallback(d=>Array.from(d.clipboardData?.items||[]).filter(m=>m.kind==="file"&&m.type.startsWith("image/")).map(m=>m.getAsFile()).filter(m=>m instanceof File),[]),G=o.useCallback(async d=>{const u=je(d);if(u.length){if(d.preventDefault(),h){await h(u);return}u.forEach(()=>Z())}},[je,Z,h]),Be=o.useCallback(async d=>{const u=Array.from(d.dataTransfer?.files||[]).filter(m=>m.type.startsWith("image/"));if(u.length){if(d.preventDefault(),h){await h(u);return}u.forEach(()=>Z())}},[Z,h]),Ne=()=>r.jsx(Me.TextArea,{ref:ne,value:t,onChange:d=>e(d.target.value),onScroll:()=>he("editor"),placeholder:s,style:{fontSize:a,...se}}),me=()=>r.jsx("div",{ref:D,className:"operit-visual-editor markdown-body",contentEditable:!0,suppressContentEditableWarning:!0,role:"textbox","aria-multiline":!0,"data-placeholder":s,onInput:d=>q(d.currentTarget),onPaste:d=>{G(d)},onDragOver:d=>{Array.from(d.dataTransfer?.types||[]).includes("Files")&&d.preventDefault()},onDrop:d=>{Be(d)},onScroll:()=>he("editor"),style:{fontSize:a,...se}}),ve=()=>n==="visual"?me():Ne(),ee=()=>r.jsx("div",{ref:J,onScroll:()=>he("preview"),style:{padding:12,border:"1px solid var(--border-color)",borderRadius:8,background:"var(--card-background)",...se},children:t.trim()?r.jsx(Xr,{content:t,resolveImageUrl:$}):r.jsx(nn,{type:"secondary",children:l.previewEmpty})});return r.jsxs(_,{direction:"vertical",size:"middle",style:{width:"100%"},children:[n==="visual"&&r.jsxs(_,{wrap:!0,children:[r.jsx(R,{title:l.toolbarBold,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("bold");return}w("**","**","bold")},icon:r.jsx(xr,{})})}),r.jsx(R,{title:l.toolbarItalic,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("italic");return}w("*","*","italic")},icon:r.jsx(Lr,{})})}),r.jsx(R,{title:l.toolbarStrike,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("strikeThrough");return}w("~~","~~","strike")},icon:r.jsx(Ur,{})})}),r.jsx(R,{title:l.toolbarH1,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("formatBlock","h1");return}P("# ")},icon:r.jsx(Xe,{})})}),r.jsx(R,{title:l.toolbarH2,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("formatBlock","h2");return}P("## ")},icon:r.jsx(Xe,{})})}),r.jsx(R,{title:l.toolbarH3,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("formatBlock","h3");return}P("### ")},icon:r.jsx(Xe,{})})}),r.jsx(R,{title:l.toolbarQuote,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("formatBlock","blockquote");return}P("> ")},icon:r.jsx(or,{})})}),r.jsx(R,{title:l.toolbarList,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("insertUnorderedList");return}P("- ")},icon:r.jsx(Wr,{})})}),r.jsx(R,{title:l.toolbarOrdered,children:r.jsx(j,{onClick:()=>{if(n==="visual"){T("insertOrderedList");return}P("",!0)},icon:r.jsx(Hr,{})})}),r.jsx(R,{title:l.toolbarChecklist,children:r.jsx(j,{onClick:()=>{if(n==="visual"){ye();return}P("- [ ] ")},icon:r.jsx(vr,{})})}),r.jsx(R,{title:l.toolbarCode,children:r.jsx(j,{onClick:()=>{if(n==="visual"){He();return}w("`","`","code")},icon:r.jsx(kr,{})})}),r.jsx(R,{title:l.toolbarCodeBlock,children:r.jsx(j,{onClick:()=>{if(n==="visual"){Ee();return}M()},icon:r.jsx(Sr,{})})}),r.jsx(R,{title:l.toolbarLink,children:r.jsx(j,{onClick:()=>{if(n==="visual"){Oe();return}w("[","](url)","text")},icon:r.jsx(Rr,{})})}),r.jsx(R,{title:l.toolbarImage,children:r.jsx(j,{onClick:()=>{if(h){h();return}if(n==="visual"){Z();return}w("![",`](${Qe})`,"image")},icon:r.jsx(Dr,{})})})]}),c==="edit"&&ve(),c==="preview"&&ee(),c==="split"&&r.jsxs(pe,{gutter:[16,16],children:[r.jsx(H,{xs:24,md:12,children:ve()}),r.jsx(H,{xs:24,md:12,children:ee()})]})]})}),an="operit_submission_local_assets",xe="images",on=1,cn="operit-local://",ut=/^[a-z0-9][a-z0-9_-]{7,63}$/i,ht=()=>new Promise((t,e)=>{const s=indexedDB.open(an,on);s.onupgradeneeded=()=>{const n=s.result;n.objectStoreNames.contains(xe)||n.createObjectStore(xe,{keyPath:"id"})},s.onsuccess=()=>t(s.result),s.onerror=()=>e(s.error||new Error("open_indexeddb_failed"))}),ln=(t,e="image")=>{const s=String(t).trim().replace(/[\\/]/g,"_").replace(/\s+/g,"-").replace(/[^a-zA-Z0-9._-]/g,"-").replace(/-+/g,"-").replace(/^[-_.]+|[-_.]+$/g,"");return s?s.slice(0,100):e},dn=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?`img_${crypto.randomUUID().replace(/-/g,"")}`:`img_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,12)}`,un=(t,e)=>new Promise((s,n)=>{const a=t.transaction(xe,"readonly").objectStore(xe);e(a,s,n)}),Mt=(t,e)=>new Promise((s,n)=>{const c=t.transaction(xe,"readwrite"),a=c.objectStore(xe);e(a,s,n),c.onerror=()=>n(c.error||new Error("indexeddb_write_failed"))}),St=async t=>{const s={id:dn(),name:ln(t.name||"image"),type:t.type||"application/octet-stream",size:t.size,created_at:new Date().toISOString(),blob:t},n=await ht();return await Mt(n,(c,a,l)=>{const h=c.put(s);h.onsuccess=()=>a(),h.onerror=()=>l(h.error||new Error("save_local_image_failed"))}),s},Ot=async t=>{if(!ut.test(t))return null;const e=await ht();return un(e,(s,n,c)=>{const a=s.get(t);a.onsuccess=()=>{const l=a.result;if(!l?.id||!(l.blob instanceof Blob)){n(null);return}n(l)},a.onerror=()=>c(a.error||new Error("read_local_image_failed"))})},hn=async t=>{if(!ut.test(t))return;const e=await ht();await Mt(e,(s,n,c)=>{const a=s.delete(t);a.onsuccess=()=>n(),a.onerror=()=>c(a.error||new Error("delete_local_image_failed"))})},Et=t=>{const e=String(t||""),s=/operit-local:\/\/([a-z0-9][a-z0-9_-]{7,63})/gi,n=new Set;let c=s.exec(e);for(;c;){const a=(c[1]||"").trim();ut.test(a)&&n.add(a),c=s.exec(e)}return Array.from(n)},Tt=t=>`${cn}${t}`,{Content:mn}=Jt,{Title:Ae,Paragraph:_t,Text:x}=Lt,fn=(t,e)=>{for(const s of t.split(`
`)){const n=s.trim().match(/^#\s+(.+)$/);if(n)return n[1].trim()}return e},gn=t=>t.endsWith("/")?t:`${t}/`,Re=t=>new Date(t).toLocaleString(),pn=async t=>{const e=await t.arrayBuffer(),s=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")},bn={"image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/webp":"webp","image/gif":"gif","image/svg+xml":"svg"},xn=t=>{const e=String(t||"").match(/^data:(image\/[a-z0-9.+-]+);base64,([a-z0-9+/=\s]+)$/i);if(!e)return null;const s=e[1].toLowerCase(),n=e[2].replace(/\s+/g,"");try{const c=atob(n),a=new Uint8Array(c.length);for(let l=0;l<c.length;l+=1)a[l]=c.charCodeAt(l);return{mime:s,bytes:a}}catch{return null}},Ln=({language:t})=>{const e=Kt[t].submission,s=Xt(),n=Qt(),a=o.useMemo(()=>new URLSearchParams(s.search),[s.search]).get("path")||"",l=localStorage.getItem("operit_submission_admin_api_base")||"https://api.aaswordsman.org",h=o.useMemo(()=>a?`operit_submission_draft:${a}`:"",[a]),$=o.useRef(null),[Q,ne]=o.useState(!1),[D,J]=o.useState(null),[k,L]=o.useState(""),[g,F]=o.useState(""),[q,W]=o.useState(""),[T,Y]=o.useState(""),[w,P]=o.useState(""),[M,se]=o.useState(""),[he,ye]=o.useState(""),[Oe,Z]=o.useState(""),[He,Ee]=o.useState(!1),[je,G]=o.useState(null),[Be,Ne]=o.useState(0),[me,ve]=o.useState(null),[ee,d]=o.useState(null),[u,m]=o.useState(null),[C,v]=o.useState(!1),[y,O]=o.useState(null),[z,ae]=o.useState([]),[te,oe]=o.useState("visual"),[re,Te]=o.useState("split"),[fe,De]=o.useState(14),[we,zt]=o.useState([]),[mt,ft]=o.useState(!1),[_e,Pe]=o.useState({}),Ve=o.useRef({}),Ht=o.useCallback(i=>{ye(i)},[]),Bt=o.useCallback(()=>{ye("")},[]),Ue=o.useMemo(()=>a.includes("/en/")?"en":a.includes("/zh/")?"zh":t,[a,t]),Fe=o.useMemo(()=>!!(k.trim()||g.trim()||w.trim()||M.trim()),[k,g,w,M]),Le=o.useMemo(()=>{const i=k.trim()&&k.trim()!==q.trim(),f=g.trim()&&g.trim()!==T.trim(),p=!!(w.trim()||M.trim());return!!(i||f||p)},[k,g,w,M,q,T]),qe=o.useCallback(i=>{if(!h||!a||!Fe||!i&&!Le)return;const f={target_path:a,title:k,content:g,author_name:w,author_email:M,updated_at:new Date().toISOString()};try{cr(f),O(f.updated_at),m(f)}catch{}},[h,a,Fe,Le,k,g,w,M]),gt=o.useCallback(async()=>{if(!a){J(e.errorMissingPath);return}if(!a.startsWith("content/")){J(e.errorInvalidPath);return}ne(!0),J(null);try{const i=gn("./"),f=await fetch(`${i}${a}`);if(!f.ok)throw new Error(e.errorLoadFailed);const p=await f.text();F(p);const S=fn(p,a.split("/").pop()||e.defaultTitle);L(b=>b||S),W(S),Y(p)}catch(i){J(i.message||e.errorLoadFailed)}finally{ne(!1)}},[a,e]),pt=o.useCallback(async()=>{try{const i=await fetch(`${l.replace(/\/+$/,"")}/api/config`);if(!i.ok)return;const f=await i.json();f?.turnstile_site_key&&Z(f.turnstile_site_key)}catch{Z("")}},[l]);o.useEffect(()=>{gt(),pt()},[gt,pt]),o.useEffect(()=>{if(h)try{const i=lr(a);if(i?.target_path===a){m(i),v(!0),O(i.updated_at||null);return}m(null),v(!1),O(null)}catch{m(null),v(!1),O(null)}},[h,a]),o.useEffect(()=>{ae(dr().slice(0,50))},[]),o.useEffect(()=>{zt(ur())},[]),o.useEffect(()=>{const i=hr();oe(i.editorMode),Te(i.viewMode),De(i.fontSize||14),P(f=>f||i.authorName),se(f=>f||i.authorEmail)},[]),o.useEffect(()=>{mr({authorName:w,authorEmail:M,editorMode:te,viewMode:re,fontSize:fe})},[w,M,te,re,fe]),o.useEffect(()=>{if(!h||C||!Le)return;const i=window.setTimeout(()=>{qe(),yt(a,{status:"edited",updated_at:new Date().toISOString(),title:k.trim()||a})},700);return()=>window.clearTimeout(i)},[h,C,Le,qe,a,k]),o.useEffect(()=>{Ve.current=_e},[_e]),o.useEffect(()=>{const i=Et(g);if(!i.length){Pe(b=>(Object.values(b).forEach(A=>URL.revokeObjectURL(A)),Object.keys(b).length?{}:b));return}const f=new Set(i);Pe(b=>{const I={};Object.entries(b).forEach(([E,ie])=>{f.has(E)?I[E]=ie:URL.revokeObjectURL(ie)});const A=Object.keys(b),V=Object.keys(I);return A.length===V.length&&A.every(E=>I[E]===b[E])?b:I});let p=!1;return(async()=>{for(const b of i){if(p)return;if(!Ve.current[b])try{const I=await Ot(b);if(!I?.blob||p)continue;const A=URL.createObjectURL(I.blob);Pe(V=>!f.has(b)||V[b]?(URL.revokeObjectURL(A),V):{...V,[b]:A})}catch{}}})(),()=>{p=!0}},[g]),o.useEffect(()=>()=>{Object.values(Ve.current).forEach(i=>URL.revokeObjectURL(i))},[]);const Nt=()=>{u&&(L(u.title||""),F(u.content||""),P(u.author_name||""),se(u.author_email||""),v(!1),O(u.updated_at||null))},bt=()=>{if(h)try{fr(a)}catch{}m(null),v(!1),O(null)},Dt=()=>{ae([]);try{jt([])}catch{}},Pt=i=>{const f=we.find(S=>S.id===i);if(!f)return;const p=g.trim()?`

${f.content}
`:`${f.content}
`;$.current?.insertText(p),N.success(e.templateInserted)},Vt=o.useCallback(i=>{const f=i.match(/^operit-local:\/\/([a-z0-9][a-z0-9_-]{7,63})$/i);return f?_e[f[1]]||"":i},[_e]),Ut=o.useCallback(async i=>{if(mt)return;let f=i?Array.from(i):[];if(!f.length){const p=document.createElement("input");p.type="file",p.accept="image/*",p.multiple=!0,f=await new Promise(S=>{p.onchange=()=>{const b=p.files?Array.from(p.files):[];S(b)},p.click()})}if(f.length){ft(!0);try{let p=0;for(const S of f){if(!S.type.startsWith("image/")){N.warning(`${S.name}: unsupported image type`);continue}const b=await St(S),I=(b.name||"image").replace(/\.[^.]+$/,"");$.current?.insertText(`![${I}](${Tt(b.id)})`),p+=1}p>0&&N.success(`Inserted ${p} image${p>1?"s":""}`)}catch{N.error("Image insert failed")}finally{ft(!1)}}},[mt]),Ft=o.useCallback(async i=>{const f=String(i||""),p=/!\[([^\]]*)\]\((data:image\/[a-z0-9.+-]+;base64,[^)\s]+)\)/gi;let S=f,b=0;const I=Array.from(f.matchAll(p));for(const A of I){const V=A[0],E=A[1]||"image",ie=A[2]||"",ce=xn(ie);if(!ce)continue;const Ie=bn[ce.mime]||"bin",K=`${E.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"")||"image"}.${Ie}`,le=new File([ce.bytes],K,{type:ce.mime}),de=await St(le),We=`![${E}](${Tt(de.id)})`;S=S.replace(V,We),b+=1}return{markdown:S,convertedCount:b}},[]),qt=async()=>{if(G(null),!k.trim()){const i=e.errorTitleRequired;G(i),N.error(i);return}if(!g.trim()||g.trim().length<20){const i=e.errorContentTooShort;G(i),N.error(i);return}if(!w.trim()){const i=e.errorAuthorRequired;G(i),N.error(i);return}if(!he){const i=e.errorTurnstileRequired;G(i),N.error(i);return}Ee(!0),d(null);try{const i=await Ft(g),f=i.markdown;f!==g&&F(f),i.convertedCount>0&&N.info(`Converted ${i.convertedCount} pasted image${i.convertedCount>1?"s":""} to local assets`);const p=Et(f),S=new FormData,b={type:"edit",language:Ue,target_path:a,title:k.trim(),content:f.trim(),author_name:w.trim(),author_email:M.trim()||void 0,turnstile_token:he};if(S.set("payload",JSON.stringify(b)),p.length){const B=[];for(const K of p){const le=await Ot(K);if(!le?.blob)throw new Error(`local_image_missing:${K}`);const de=new File([le.blob],le.name||`${K}.bin`,{type:le.type||"application/octet-stream"}),We=await pn(le.blob);B.push({id:K,name:de.name,type:de.type,size:de.size,sha256:We}),S.append(`asset_${K}`,de,de.name)}S.set("assets_manifest",JSON.stringify(B))}const I=new AbortController,A=window.setTimeout(()=>I.abort(),45e3),V=await fetch(`${l.replace(/\/+$/,"")}/api/submissions`,{method:"POST",body:S,signal:I.signal});window.clearTimeout(A);const E=await V.json().catch(()=>({}));if(!V.ok){if(E?.error==="ip_banned"){d({reason:E?.reason||null,expires_at:E?.expires_at||null,created_at:E?.created_at||null,banned_by:E?.banned_by||null}),G(e.ipBanTitle),N.error(e.ipBanTitle);return}const B=E?.error?`${e.errorSubmitFailed}: ${E.error}`:e.errorSubmitFailed;throw G(B),new Error(B)}const ie=E?.created_at||new Date().toISOString(),ce=E?.status||"pending",Ie=E?.id||"-";ve({id:Ie,status:ce,created_at:ie});for(const B of p)try{await hn(B)}catch{}ae(B=>{const K=[{id:Ie,status:ce,created_at:ie,title:k.trim(),target_path:a,language:Ue,author_name:w.trim(),author_email:M.trim()||void 0},...B].slice(0,50);try{jt(K)}catch{}return K}),yt(a,{status:"submitted",updated_at:new Date().toISOString(),title:k.trim()||a}),N.success(e.submitSuccess),d(null),ye(""),Ne(B=>B+1)}catch(i){const f=i.name==="AbortError"?e.errorSubmitTimeout:i.message||e.errorSubmitFailed;G(f),N.error(f)}finally{Ee(!1)}};return r.jsx("main",{style:{paddingTop:88,paddingBottom:48},children:r.jsxs(mn,{style:{maxWidth:1100,margin:"0 auto",padding:"0 24px"},children:[r.jsx(ge,{children:r.jsxs(_,{direction:"vertical",size:"middle",style:{width:"100%"},children:[r.jsxs("div",{children:[r.jsx(Ae,{level:2,style:{marginBottom:8},children:e.title}),r.jsx(_t,{type:"secondary",style:{marginBottom:0},children:e.subtitle})]}),r.jsx(ue,{type:"info",showIcon:!0,message:e.ipNotice}),r.jsx(_,{children:r.jsx(j,{onClick:()=>n("/operit-submission-center"),children:e.openCenter})})]})}),r.jsx(ge,{style:{marginTop:16},children:r.jsxs(pe,{gutter:[16,16],children:[r.jsxs(H,{xs:24,md:16,children:[r.jsx(x,{type:"secondary",children:e.pathLabel}),r.jsx("div",{children:r.jsx(x,{code:!0,children:a||"-"})})]}),r.jsxs(H,{xs:24,md:8,children:[r.jsx(x,{type:"secondary",children:e.languageLabel}),r.jsx("div",{children:r.jsx(Ke,{children:Ue})})]})]})}),D&&r.jsx(ue,{type:"error",showIcon:!0,style:{marginTop:16},message:e.errorTitle,description:D}),ee&&r.jsx(ue,{type:"error",showIcon:!0,style:{marginTop:16},message:e.ipBanTitle,description:r.jsxs(_,{direction:"vertical",size:0,children:[r.jsx(x,{children:e.ipBanSubtitle}),r.jsxs(x,{type:"secondary",children:[e.ipBanReasonLabel,": ",ee.reason||"-"]}),r.jsxs(x,{type:"secondary",children:[e.ipBanExpiresLabel,":"," ",ee.expires_at?Re(ee.expires_at):e.ipBanPermanent]}),r.jsxs(x,{type:"secondary",children:[e.ipBanByLabel,": ",ee.banned_by||"-"]})]})}),me?r.jsx(ge,{style:{marginTop:16},children:r.jsxs(_,{direction:"vertical",size:"middle",style:{width:"100%"},children:[r.jsxs(_,{align:"center",children:[r.jsx(ir,{style:{color:"#52c41a",fontSize:20}}),r.jsx(Ae,{level:4,style:{margin:0},children:e.successTitle})]}),r.jsx(_t,{type:"secondary",style:{marginBottom:0},children:e.successSubtitle}),r.jsxs(pe,{gutter:[16,16],children:[r.jsxs(H,{xs:24,md:8,children:[r.jsx(x,{type:"secondary",children:e.successIdLabel}),r.jsx("div",{children:r.jsx(x,{code:!0,children:me.id})})]}),r.jsxs(H,{xs:24,md:8,children:[r.jsx(x,{type:"secondary",children:e.successStatusLabel}),r.jsx("div",{children:r.jsx(Ke,{color:"gold",children:me.status})})]}),r.jsxs(H,{xs:24,md:8,children:[r.jsx(x,{type:"secondary",children:e.successTimeLabel}),r.jsx("div",{children:new Date(me.created_at).toLocaleString()})]})]}),r.jsx(ue,{type:"info",showIcon:!0,message:e.successTip}),r.jsxs(_,{children:[r.jsx(j,{onClick:()=>n(-1),children:e.backToDoc}),r.jsx(j,{onClick:()=>ve(null),children:e.submitAnother})]})]})}):r.jsxs(r.Fragment,{children:[C&&u&&!Q&&r.jsx(ue,{type:"warning",showIcon:!0,style:{marginTop:16},message:e.draftFound,description:e.draftFoundDesc.replace("{time}",Re(u.updated_at)),action:r.jsxs(_,{direction:"vertical",children:[r.jsx(j,{size:"small",type:"primary",onClick:Nt,children:e.draftUse}),r.jsx(j,{size:"small",onClick:bt,children:e.draftDiscard})]})}),r.jsx(ge,{style:{marginTop:16},children:Q?r.jsx("div",{style:{textAlign:"center",padding:32},children:r.jsx(Yt,{})}):r.jsxs(_,{direction:"vertical",size:"middle",style:{width:"100%"},children:[r.jsxs("div",{children:[r.jsx(x,{type:"secondary",children:e.titleLabel}),r.jsx(Me,{value:k,onChange:i=>L(i.target.value)})]}),r.jsx("div",{children:r.jsxs(_,{direction:"vertical",size:"small",style:{width:"100%"},children:[r.jsxs(pe,{gutter:[12,12],align:"middle",children:[r.jsxs(H,{xs:24,md:16,children:[r.jsx(x,{type:"secondary",children:e.templateInsertLabel}),r.jsx(gr,{style:{width:"100%"},placeholder:e.templateSelectPlaceholder,options:we.map(i=>({value:i.id,label:i.title})),onSelect:i=>Pt(i),disabled:!we.length})]}),r.jsxs(H,{xs:24,md:8,children:[r.jsx(x,{type:"secondary",style:{display:"block"},children:e.templateManageLabel}),r.jsx(j,{onClick:()=>n("/operit-submission-center"),children:e.templateManageButton})]})]}),r.jsxs(pe,{gutter:[12,12],align:"middle",children:[r.jsxs(H,{xs:24,md:12,children:[r.jsx(x,{type:"secondary",children:e.editorModeLabel}),r.jsx("div",{children:r.jsx(vt,{value:te,options:[{label:e.editorModeVisual,value:"visual"},{label:e.editorModeMarkdown,value:"markdown"}],onChange:i=>oe(i)})})]}),r.jsxs(H,{xs:24,md:12,children:[r.jsx(x,{type:"secondary",children:e.viewModeLabel}),r.jsx("div",{children:r.jsx(vt,{value:re,options:[{label:e.viewModeEdit,value:"edit"},{label:e.viewModeSplit,value:"split"},{label:e.viewModePreview,value:"preview"}],onChange:i=>Te(i)})})]})]}),r.jsx(x,{type:"secondary",children:e.contentLabel}),r.jsx(sn,{ref:$,value:g,onChange:F,placeholder:e.contentPlaceholder,mode:te,view:re,fontSize:fe,onInsertImage:Ut,resolveImageUrl:Vt,labels:{toolbarBold:e.toolbarBold,toolbarItalic:e.toolbarItalic,toolbarStrike:e.toolbarStrike,toolbarH1:e.toolbarH1,toolbarH2:e.toolbarH2,toolbarH3:e.toolbarH3,toolbarQuote:e.toolbarQuote,toolbarCode:e.toolbarCode,toolbarCodeBlock:e.toolbarCodeBlock,toolbarList:e.toolbarList,toolbarOrdered:e.toolbarOrdered,toolbarChecklist:e.toolbarChecklist,toolbarLink:e.toolbarLink,toolbarImage:e.toolbarImage,previewEmpty:e.previewEmpty}})]})}),r.jsxs(pe,{gutter:[16,16],children:[r.jsxs(H,{xs:24,md:12,children:[r.jsx(x,{type:"secondary",children:e.authorLabel}),r.jsx(Me,{value:w,onChange:i=>P(i.target.value),placeholder:e.authorPlaceholder})]}),r.jsxs(H,{xs:24,md:12,children:[r.jsx(x,{type:"secondary",children:e.emailLabel}),r.jsx(Me,{value:M,onChange:i=>se(i.target.value),placeholder:e.emailPlaceholder})]})]}),r.jsxs("div",{children:[r.jsx(x,{type:"secondary",children:e.turnstileLabel}),r.jsx("div",{style:{marginTop:8},children:Oe?r.jsx(Zt,{siteKey:Oe,onVerify:Ht,onExpire:Bt},Be):r.jsx(ue,{type:"warning",message:e.turnstileMissing,showIcon:!0})})]}),je&&r.jsx(ue,{type:"error",showIcon:!0,message:e.errorTitle,description:je}),r.jsxs(_,{children:[r.jsx(j,{onClick:()=>n(-1),children:e.back}),r.jsx(j,{type:"primary",loading:He,onClick:qt,children:e.submitButton})]})]})}),r.jsx(ge,{style:{marginTop:16},children:r.jsxs(_,{direction:"vertical",size:"small",style:{width:"100%"},children:[r.jsx(Ae,{level:4,style:{margin:0},children:e.draftTitle}),y?r.jsx(x,{type:"secondary",children:e.draftSavedAt.replace("{time}",Re(y))}):r.jsx(x,{type:"secondary",children:e.draftEmpty}),r.jsxs(_,{children:[r.jsx(j,{onClick:()=>qe(!0),disabled:!Fe,children:e.draftSave}),r.jsx(j,{onClick:bt,disabled:!y&&!u,children:e.draftClear})]})]})})]}),r.jsx(ge,{style:{marginTop:16},children:r.jsxs(_,{direction:"vertical",size:"middle",style:{width:"100%"},children:[r.jsx(Ae,{level:4,style:{margin:0},children:e.historyTitle}),z.length?r.jsx(Ge,{size:"small",dataSource:z,renderItem:i=>r.jsx(Ge.Item,{actions:[r.jsx(Ke,{children:i.language},`${i.id}-lang`),r.jsx(x,{code:!0,children:i.id},`${i.id}-id`)],children:r.jsx(Ge.Item.Meta,{title:i.title||e.historyUntitled,description:r.jsxs(_,{direction:"vertical",size:0,children:[r.jsx(x,{type:"secondary",children:i.target_path}),r.jsxs(x,{type:"secondary",children:[i.status," | ",Re(i.created_at)]})]})})})}):r.jsx(x,{type:"secondary",children:e.historyEmpty}),r.jsx(_,{children:r.jsx(j,{onClick:Dt,disabled:!z.length,children:e.historyClear})})]})})]})})};export{Ln as default};
