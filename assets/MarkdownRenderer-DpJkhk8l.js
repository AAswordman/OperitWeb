import{r as o,I as S,E as T,t as v,u as N,j as e,S as k,h as P,B as z,T as b}from"./index-DW90cALs.js";import{I,M,r as O,a as U,b as B,c as C,h as F,v as G}from"./remarkDetails-CLcS4REf.js";import{A as W}from"./index-6sCwwM5z.js";import"./EyeOutlined-ClJVqZwU.js";import"./addEventListener-D-R4d1yj.js";function w(){return w=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i])}return t},w.apply(this,arguments)}const A=(t,s)=>o.createElement(S,w({},t,{ref:s,icon:T})),D=o.forwardRef(A),L=G,V=t=>{const[s,c]=o.useState(!1),i=o.useRef(null);return o.useEffect(()=>{const l=new IntersectionObserver(u=>{u.forEach(f=>{f.isIntersecting&&(c(!0),l.disconnect())})},{rootMargin:"100px"}),d=i.current;return d&&l.observe(d),()=>{d&&l.unobserve(d),l.disconnect()}},[]),e.jsx("div",{ref:i,className:"lazy-image-wrapper",children:s?e.jsx(I,{...t}):e.jsx("div",{className:"lazy-image-placeholder",children:e.jsx(k,{size:"small"})})})},Q=({file:t,language:s})=>{const[c,i]=o.useState(""),[l,d]=o.useState(!0),[u,f]=o.useState(null),[m,g]=o.useState(null),p=v[s].guide,j=v[s].submission,$=N();o.useEffect(()=>{(async()=>{d(!0),f(null);try{const n=await fetch(`./content/${s}/${t}.md`);if(n.ok){const r=await n.text();i(r),g(`content/${s}/${t}.md`)}else if(s==="en"){const r=await fetch(`./content/zh/${t}.md`);if(r.ok){const x=await r.text();i(x),g(`content/zh/${t}.md`)}else throw new Error(`Failed to fetch markdown file: ${t}.md`)}else throw new Error(`Failed to fetch markdown file: ${t}.md`)}catch(n){console.error(`Failed to load markdown file: ${t}.md`,n),f(p.loadError)}finally{d(!1)}})()},[t,s,p.loadError]);const E=a=>a.startsWith("/")&&!a.startsWith("//")?`${"./".endsWith("/")?"./".slice(0,-1):"./"}${a}`:a;if(l)return e.jsx("div",{className:"loading-container",children:e.jsx(k,{size:"large"})});if(u)return e.jsx(W,{message:p.errorTitle,description:u,type:"error",showIcon:!0});const R=()=>{m&&$(`/operit-submission-edit?path=${encodeURIComponent(m)}`)};return e.jsxs("div",{children:[e.jsxs("div",{className:"markdown-edit-bar",children:[e.jsxs(P,{wrap:!0,children:[e.jsx(z,{type:"primary",icon:e.jsx(D,{}),onClick:R,disabled:!m,children:j.editButton}),e.jsx(b.Text,{type:"secondary",children:j.editHint})]}),m&&e.jsx(b.Text,{type:"secondary",className:"markdown-edit-path",children:m})]}),e.jsx("div",{className:"markdown-body",children:e.jsx(I.PreviewGroup,{children:e.jsx(M,{remarkPlugins:[U,B,C],rehypePlugins:[O],urlTransform:E,components:{code({inline:a,className:n,children:r,style:x,...h}){const y=/language-(\w+)/.exec(n||"");return!a&&y?e.jsx(F,{style:L,language:y[1],PreTag:"div",...h,children:String(r).replace(/\n$/,"")}):e.jsx("code",{className:n,...h,children:r})},img:({node:a,onClick:n,...r})=>e.jsx(V,{...r}),p:({node:a,children:n,...r})=>a?.children.some(h=>h.type==="element"&&h.tagName==="img")?e.jsx("div",{className:"paragraph-with-image",...r,children:n}):e.jsx("p",{...r,children:n})},children:c})})})]})};export{Q as default};
