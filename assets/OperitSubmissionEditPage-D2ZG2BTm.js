import{r,I as k,b3 as st,j as e,f as at,h as b,aY as w,B as d,d as N,C as O,T as Qe,t as it,a as ot,u as ct,b as lt,e as W,S as dt}from"./index-CEEpnjf-.js";import{s as ht,g as ut,a as mt,b as pt,c as gt,d as xt,e as qe,T as ft,L as ye,f as jt,h as We}from"./operitLocalStore-DwLbWYtL.js";import{I as Ne,M as bt,r as vt,a as yt,b as wt,c as St,h as Ot,v as Ct}from"./remarkDetails-BeI9NnMp.js";import{a as Tt,R as kt}from"./CheckCircleOutlined-CpjX9PLZ.js";import{I as le}from"./index-B_XlWCKz.js";import{A as B}from"./index-BrmGAcRJ.js";import{T as we,a as $t,S as Ke}from"./index-C6zR8BxE.js";import{s as H}from"./index-CXB2anWG.js";import"./EyeOutlined-DAujbhyL.js";import"./addEventListener-rRD0xiOj.js";var zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"};function Oe(){return Oe=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Oe.apply(this,arguments)}const It=(n,t)=>r.createElement(k,Oe({},n,{ref:t,icon:zt})),Lt=r.forwardRef(It);var Et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"};function Ce(){return Ce=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Ce.apply(this,arguments)}const _t=(n,t)=>r.createElement(k,Ce({},n,{ref:t,icon:Et})),Ht=r.forwardRef(_t);var Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"};function Te(){return Te=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Te.apply(this,arguments)}const Rt=(n,t)=>r.createElement(k,Te({},n,{ref:t,icon:Mt})),Bt=r.forwardRef(Rt);function ke(){return ke=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},ke.apply(this,arguments)}const Pt=(n,t)=>r.createElement(k,ke({},n,{ref:t,icon:st})),Dt=r.forwardRef(Pt);var Vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 416H616c-4.4 0-8 3.6-8 8v112c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-56h60v320h-46c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h164c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8h-46V480h60v56c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V424c0-4.4-3.6-8-8-8zM656 296V168c0-4.4-3.6-8-8-8H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8z"}}]},name:"font-size",theme:"outlined"};function $e(){return $e=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},$e.apply(this,arguments)}const At=(n,t)=>r.createElement(k,$e({},n,{ref:t,icon:Vt})),Se=r.forwardRef(At);var Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"italic",theme:"outlined"};function ze(){return ze=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},ze.apply(this,arguments)}const Ut=(n,t)=>r.createElement(k,ze({},n,{ref:t,icon:Ft})),qt=r.forwardRef(Ut);var Wt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function Ie(){return Ie=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Ie.apply(this,arguments)}const Nt=(n,t)=>r.createElement(k,Ie({},n,{ref:t,icon:Wt})),Kt=r.forwardRef(Nt);var Gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 760H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-568H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM216 712H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h72.4v20.5h-35.7c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h35.7V838H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4V716c0-2.2-1.8-4-4-4zM100 188h38v120c0 2.2 1.8 4 4 4h40c2.2 0 4-1.8 4-4V152c0-4.4-3.6-8-8-8h-78c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4zm116 240H100c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4h68.4l-70.3 77.7a8.3 8.3 0 00-2.1 5.4V592c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4v-36c0-2.2-1.8-4-4-4h-68.4l70.3-77.7a8.3 8.3 0 002.1-5.4V432c0-2.2-1.8-4-4-4z"}}]},name:"ordered-list",theme:"outlined"};function Le(){return Le=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Le.apply(this,arguments)}const Qt=(n,t)=>r.createElement(k,Le({},n,{ref:t,icon:Gt})),Yt=r.forwardRef(Qt);var Jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2zM304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z"}}]},name:"picture",theme:"outlined"};function Ee(){return Ee=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Ee.apply(this,arguments)}const Xt=(n,t)=>r.createElement(k,Ee({},n,{ref:t,icon:Jt})),Zt=r.forwardRef(Xt);var en={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M952 474H569.9c-10-2-20.5-4-31.6-6-15.9-2.9-22.2-4.1-30.8-5.8-51.3-10-82.2-20-106.8-34.2-35.1-20.5-52.2-48.3-52.2-85.1 0-37 15.2-67.7 44-89 28.4-21 68.8-32.1 116.8-32.1 54.8 0 97.1 14.4 125.8 42.8 14.6 14.4 25.3 32.1 31.8 52.6 1.3 4.1 2.8 10 4.3 17.8.9 4.8 5.2 8.2 9.9 8.2h72.8c5.6 0 10.1-4.6 10.1-10.1v-1c-.7-6.8-1.3-12.1-2-16-7.3-43.5-28-81.7-59.7-110.3-44.4-40.5-109.7-61.8-188.7-61.8-72.3 0-137.4 18.1-183.3 50.9-25.6 18.4-45.4 41.2-58.6 67.7-13.5 27.1-20.3 58.4-20.3 92.9 0 29.5 5.7 54.5 17.3 76.5 8.3 15.7 19.6 29.5 34.1 42H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h433.2c2.1.4 3.9.8 5.9 1.2 30.9 6.2 49.5 10.4 66.6 15.2 23 6.5 40.6 13.3 55.2 21.5 35.8 20.2 53.3 49.2 53.3 89 0 35.3-15.5 66.8-43.6 88.8-30.5 23.9-75.6 36.4-130.5 36.4-43.7 0-80.7-8.5-110.2-25-29.1-16.3-49.1-39.8-59.7-69.5-.8-2.2-1.7-5.2-2.7-9-1.2-4.4-5.3-7.5-9.7-7.5h-79.7c-5.6 0-10.1 4.6-10.1 10.1v1c.2 2.3.4 4.2.6 5.7 6.5 48.8 30.3 88.8 70.7 118.8 47.1 34.8 113.4 53.2 191.8 53.2 84.2 0 154.8-19.8 204.2-57.3 25-18.9 44.2-42.2 57.1-69 13-27.1 19.7-57.9 19.7-91.5 0-31.8-5.8-58.4-17.8-81.4-5.8-11.2-13.1-21.5-21.8-30.8H952c4.4 0 8-3.6 8-8v-60a8 8 0 00-8-7.9z"}}]},name:"strikethrough",theme:"outlined"};function _e(){return _e=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},_e.apply(this,arguments)}const tn=(n,t)=>r.createElement(k,_e({},n,{ref:t,icon:en})),nn=r.forwardRef(tn);var rn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"};function He(){return He=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},He.apply(this,arguments)}const sn=(n,t)=>r.createElement(k,He({},n,{ref:t,icon:rn})),an=r.forwardRef(sn),on=Ct,cn=n=>n.startsWith("/")&&!n.startsWith("//")?`${"./".endsWith("/")?"./".slice(0,-1):"./"}${n}`:n,ln=({content:n})=>e.jsx("div",{className:"markdown-body",children:e.jsx(Ne.PreviewGroup,{children:e.jsx(bt,{remarkPlugins:[yt,wt,St],rehypePlugins:[vt],urlTransform:cn,components:{code({inline:t,className:i,children:a,style:M,...o}){const p=/language-(\w+)/.exec(i||"");return!t&&p?e.jsx(Ot,{style:on,language:p[1],PreTag:"div",...o,children:String(a).replace(/\n$/,"")}):e.jsx("code",{className:i,...o,children:a})},img:({node:t,onClick:i,...a})=>e.jsx(Ne,{...a})},children:n})})}),{Text:dn}=Qe,hn=at.forwardRef(({value:n,onChange:t,placeholder:i,mode:a,view:M,fontSize:o,labels:p},I)=>{const K=r.useRef(null),G=r.useRef(null),P=r.useRef(!1),E=()=>K.current?.resizableTextArea?.textArea,C=r.useCallback((j,l,x,m,f)=>{const g=E();if(!g){const S=`${n.slice(0,l)}${j}${n.slice(x)}`;t(S);return}g.focus(),g.setRangeText(j,l,x,"end"),g.setSelectionRange(m,f),g.dispatchEvent(new Event("input",{bubbles:!0}))},[n,t]),u=r.useCallback((j,l,x)=>{const m=E(),f=m?.selectionStart??n.length,g=m?.selectionEnd??n.length,S=n.slice(0,f),V=n.slice(f,g)||x,J=S.length+j.length,R=J+V.length,A=`${j}${V}${l}`;C(A,f,g,J,R)},[n,C]),T=r.useCallback((j,l)=>{const x=E(),m=x?.selectionStart??n.length,f=x?.selectionEnd??n.length,g=n.lastIndexOf(`
`,Math.max(0,m-1))+1,S=n.indexOf(`
`,f),_=S===-1?n.length:S,R=n.slice(g,_).split(`
`).map((ne,de)=>{if(l){const F=ne.replace(/^\d+\.\s+/,"");return`${de+1}. ${F}`}return`${j}${ne}`}).join(`
`),A=g,$=g+R.length;C(R,g,_,A,$)},[n,C]),y=r.useCallback(()=>{u("```\n","\n```","code")},[u]);r.useImperativeHandle(I,()=>({insertText:j=>{const l=E(),x=l?.selectionStart??n.length,m=l?.selectionEnd??n.length,f=x+j.length;C(j,x,m,f,f)}}),[n,C]);const D={height:"70vh",minHeight:360,maxHeight:"70vh",overflowY:"auto"},Q=r.useCallback(j=>{if(M!=="split"||P.current)return;const l=E(),x=G.current;if(!l||!x)return;const m=j==="editor"?l:x,f=j==="editor"?x:l,g=m.scrollHeight-m.clientHeight,S=f.scrollHeight-f.clientHeight;if(g<=0||S<=0)return;const _=m.scrollTop/g;P.current=!0,f.scrollTop=_*S,requestAnimationFrame(()=>{P.current=!1})},[M]),te=()=>e.jsx(le.TextArea,{ref:K,value:n,onChange:j=>t(j.target.value),onScroll:()=>Q("editor"),placeholder:i,style:{fontSize:o,...D}}),Y=()=>e.jsx("div",{ref:G,onScroll:()=>Q("preview"),style:{padding:12,border:"1px solid var(--border-color)",borderRadius:8,background:"var(--card-background)",...D},children:n.trim()?e.jsx(ln,{content:n}):e.jsx(dn,{type:"secondary",children:p.previewEmpty})});return e.jsxs(b,{direction:"vertical",size:"middle",style:{width:"100%"},children:[a==="visual"&&e.jsxs(b,{wrap:!0,children:[e.jsx(w,{title:p.toolbarBold,children:e.jsx(d,{onClick:()=>u("**","**","bold"),icon:e.jsx(Lt,{})})}),e.jsx(w,{title:p.toolbarItalic,children:e.jsx(d,{onClick:()=>u("*","*","italic"),icon:e.jsx(qt,{})})}),e.jsx(w,{title:p.toolbarStrike,children:e.jsx(d,{onClick:()=>u("~~","~~","strike"),icon:e.jsx(nn,{})})}),e.jsx(w,{title:p.toolbarH1,children:e.jsx(d,{onClick:()=>T("# "),icon:e.jsx(Se,{})})}),e.jsx(w,{title:p.toolbarH2,children:e.jsx(d,{onClick:()=>T("## "),icon:e.jsx(Se,{})})}),e.jsx(w,{title:p.toolbarH3,children:e.jsx(d,{onClick:()=>T("### "),icon:e.jsx(Se,{})})}),e.jsx(w,{title:p.toolbarQuote,children:e.jsx(d,{onClick:()=>T("> "),icon:e.jsx(Tt,{})})}),e.jsx(w,{title:p.toolbarList,children:e.jsx(d,{onClick:()=>T("- "),icon:e.jsx(an,{})})}),e.jsx(w,{title:p.toolbarOrdered,children:e.jsx(d,{onClick:()=>T("",!0),icon:e.jsx(Yt,{})})}),e.jsx(w,{title:p.toolbarChecklist,children:e.jsx(d,{onClick:()=>T("- [ ] "),icon:e.jsx(Ht,{})})}),e.jsx(w,{title:p.toolbarCode,children:e.jsx(d,{onClick:()=>u("`","`","code"),icon:e.jsx(Bt,{})})}),e.jsx(w,{title:p.toolbarCodeBlock,children:e.jsx(d,{onClick:y,icon:e.jsx(Dt,{})})}),e.jsx(w,{title:p.toolbarLink,children:e.jsx(d,{onClick:()=>u("[","](url)","text"),icon:e.jsx(Kt,{})})}),e.jsx(w,{title:p.toolbarImage,children:e.jsx(d,{onClick:()=>u("![","](url)","alt"),icon:e.jsx(Zt,{})})})]}),M==="edit"&&te(),M==="preview"&&Y(),M==="split"&&e.jsxs(N,{gutter:[16,16],children:[e.jsx(O,{xs:24,md:12,children:te()}),e.jsx(O,{xs:24,md:12,children:Y()})]})]})}),{Content:un}=lt,{Title:oe,Paragraph:Ge,Text:c}=Qe,mn=(n,t)=>{for(const i of n.split(`
`)){const a=i.trim().match(/^#\s+(.+)$/);if(a)return a[1].trim()}return t},pn=n=>n.endsWith("/")?n:`${n}/`,ce=n=>new Date(n).toLocaleString(),Cn=({language:n})=>{const t=it[n].submission,i=ot(),a=ct(),o=r.useMemo(()=>new URLSearchParams(i.search),[i.search]).get("path")||"",p=localStorage.getItem("operit_submission_admin_api_base")||"https://api.aaswordsman.org",I=r.useMemo(()=>o?`operit_submission_draft:${o}`:"",[o]),K=r.useRef(null),[G,P]=r.useState(!1),[E,C]=r.useState(null),[u,T]=r.useState(""),[y,D]=r.useState(""),[Q,te]=r.useState(""),[Y,j]=r.useState(""),[l,x]=r.useState(""),[m,f]=r.useState(""),[g,S]=r.useState(""),[_,V]=r.useState(""),[J,R]=r.useState(!1),[A,$]=r.useState(null),[ne,de]=r.useState(0),[F,Me]=r.useState(null),[X,he]=r.useState(null),[L,Z]=r.useState(null),[ue,ee]=r.useState(!1),[me,U]=r.useState(null),[pe,ge]=r.useState([]),[re,Re]=r.useState("visual"),[se,Be]=r.useState("split"),[xe,Ye]=r.useState(14),[fe,Je]=r.useState([]),Xe=r.useCallback(s=>{S(s)},[]),Ze=r.useCallback(()=>{S("")},[]),je=r.useMemo(()=>o.includes("/en/")?"en":o.includes("/zh/")?"zh":n,[o,n]),be=r.useMemo(()=>!!(u.trim()||y.trim()||l.trim()||m.trim()),[u,y,l,m]),ae=r.useMemo(()=>{const s=u.trim()&&u.trim()!==Q.trim(),h=y.trim()&&y.trim()!==Y.trim(),z=!!(l.trim()||m.trim());return!!(s||h||z)},[u,y,l,m,Q,Y]),ve=r.useCallback(s=>{if(!I||!o||!be||!s&&!ae)return;const h={target_path:o,title:u,content:y,author_name:l,author_email:m,updated_at:new Date().toISOString()};try{ht(h),U(h.updated_at),Z(h)}catch{}},[I,o,be,ae,u,y,l,m]),Pe=r.useCallback(async()=>{if(!o){C(t.errorMissingPath);return}if(!o.startsWith("content/")){C(t.errorInvalidPath);return}P(!0),C(null);try{const s=pn("./"),h=await fetch(`${s}${o}`);if(!h.ok)throw new Error(t.errorLoadFailed);const z=await h.text();D(z);const v=mn(z,o.split("/").pop()||t.defaultTitle);T(ie=>ie||v),te(v),j(z)}catch(s){C(s.message||t.errorLoadFailed)}finally{P(!1)}},[o,t]),De=r.useCallback(async()=>{try{const s=await fetch(`${p.replace(/\/+$/,"")}/api/config`);if(!s.ok)return;const h=await s.json();h?.turnstile_site_key&&V(h.turnstile_site_key)}catch{V("")}},[p]);r.useEffect(()=>{Pe(),De()},[Pe,De]),r.useEffect(()=>{if(I)try{const s=ut(o);if(s?.target_path===o){Z(s),ee(!0),U(s.updated_at||null);return}Z(null),ee(!1),U(null)}catch{Z(null),ee(!1),U(null)}},[I,o]),r.useEffect(()=>{ge(mt().slice(0,50))},[]),r.useEffect(()=>{Je(pt())},[]),r.useEffect(()=>{const s=gt();Re(s.editorMode),Be(s.viewMode),Ye(s.fontSize||14),x(h=>h||s.authorName),f(h=>h||s.authorEmail)},[]),r.useEffect(()=>{xt({authorName:l,authorEmail:m,editorMode:re,viewMode:se,fontSize:xe})},[l,m,re,se,xe]),r.useEffect(()=>{if(!I||ue||!ae)return;const s=window.setTimeout(()=>{ve(),qe(o,{status:"edited",updated_at:new Date().toISOString(),title:u.trim()||o})},700);return()=>window.clearTimeout(s)},[I,ue,ae,ve,o,u]);const et=()=>{L&&(T(L.title||""),D(L.content||""),x(L.author_name||""),f(L.author_email||""),ee(!1),U(L.updated_at||null))},Ve=()=>{if(I)try{jt(o)}catch{}Z(null),ee(!1),U(null)},tt=()=>{ge([]);try{We([])}catch{}},nt=s=>{const h=fe.find(v=>v.id===s);if(!h)return;const z=y.trim()?`

${h.content}
`:`${h.content}
`;K.current?.insertText(z),H.success(t.templateInserted)},rt=async()=>{if($(null),!u.trim()){const s=t.errorTitleRequired;$(s),H.error(s);return}if(!y.trim()||y.trim().length<20){const s=t.errorContentTooShort;$(s),H.error(s);return}if(!l.trim()){const s=t.errorAuthorRequired;$(s),H.error(s);return}if(!g){const s=t.errorTurnstileRequired;$(s),H.error(s);return}R(!0),he(null);try{const s=new AbortController,h=window.setTimeout(()=>s.abort(),15e3),z=await fetch(`${p.replace(/\/+$/,"")}/api/submissions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"edit",language:je,target_path:o,title:u.trim(),content:y.trim(),author_name:l.trim(),author_email:m.trim()||void 0,turnstile_token:g}),signal:s.signal});window.clearTimeout(h);const v=await z.json().catch(()=>({}));if(!z.ok){if(v?.error==="ip_banned"){he({reason:v?.reason||null,expires_at:v?.expires_at||null,created_at:v?.created_at||null,banned_by:v?.banned_by||null}),$(t.ipBanTitle),H.error(t.ipBanTitle);return}const q=v?.error?`${t.errorSubmitFailed}: ${v.error}`:t.errorSubmitFailed;throw $(q),new Error(q)}const ie=v?.created_at||new Date().toISOString(),Ae=v?.status||"pending",Fe=v?.id||"-";Me({id:Fe,status:Ae,created_at:ie}),ge(q=>{const Ue=[{id:Fe,status:Ae,created_at:ie,title:u.trim(),target_path:o,language:je},...q].slice(0,50);try{We(Ue)}catch{}return Ue}),qe(o,{status:"submitted",updated_at:new Date().toISOString(),title:u.trim()||o}),H.success(t.submitSuccess),he(null),S(""),de(q=>q+1)}catch(s){const h=s.name==="AbortError"?t.errorSubmitTimeout:s.message||t.errorSubmitFailed;$(h),H.error(h)}finally{R(!1)}};return e.jsx("main",{style:{paddingTop:88,paddingBottom:48},children:e.jsxs(un,{style:{maxWidth:1100,margin:"0 auto",padding:"0 24px"},children:[e.jsx(W,{children:e.jsxs(b,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(oe,{level:2,style:{marginBottom:8},children:t.title}),e.jsx(Ge,{type:"secondary",style:{marginBottom:0},children:t.subtitle})]}),e.jsx(B,{type:"info",showIcon:!0,message:t.ipNotice}),e.jsx(b,{children:e.jsx(d,{onClick:()=>a("/operit-submission-center"),children:t.openCenter})})]})}),e.jsx(W,{style:{marginTop:16},children:e.jsxs(N,{gutter:[16,16],children:[e.jsxs(O,{xs:24,md:16,children:[e.jsx(c,{type:"secondary",children:t.pathLabel}),e.jsx("div",{children:e.jsx(c,{code:!0,children:o||"-"})})]}),e.jsxs(O,{xs:24,md:8,children:[e.jsx(c,{type:"secondary",children:t.languageLabel}),e.jsx("div",{children:e.jsx(we,{children:je})})]})]})}),E&&e.jsx(B,{type:"error",showIcon:!0,style:{marginTop:16},message:t.errorTitle,description:E}),X&&e.jsx(B,{type:"error",showIcon:!0,style:{marginTop:16},message:t.ipBanTitle,description:e.jsxs(b,{direction:"vertical",size:0,children:[e.jsx(c,{children:t.ipBanSubtitle}),e.jsxs(c,{type:"secondary",children:[t.ipBanReasonLabel,": ",X.reason||"-"]}),e.jsxs(c,{type:"secondary",children:[t.ipBanExpiresLabel,":"," ",X.expires_at?ce(X.expires_at):t.ipBanPermanent]}),e.jsxs(c,{type:"secondary",children:[t.ipBanByLabel,": ",X.banned_by||"-"]})]})}),F?e.jsx(W,{style:{marginTop:16},children:e.jsxs(b,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(b,{align:"center",children:[e.jsx(kt,{style:{color:"#52c41a",fontSize:20}}),e.jsx(oe,{level:4,style:{margin:0},children:t.successTitle})]}),e.jsx(Ge,{type:"secondary",style:{marginBottom:0},children:t.successSubtitle}),e.jsxs(N,{gutter:[16,16],children:[e.jsxs(O,{xs:24,md:8,children:[e.jsx(c,{type:"secondary",children:t.successIdLabel}),e.jsx("div",{children:e.jsx(c,{code:!0,children:F.id})})]}),e.jsxs(O,{xs:24,md:8,children:[e.jsx(c,{type:"secondary",children:t.successStatusLabel}),e.jsx("div",{children:e.jsx(we,{color:"gold",children:F.status})})]}),e.jsxs(O,{xs:24,md:8,children:[e.jsx(c,{type:"secondary",children:t.successTimeLabel}),e.jsx("div",{children:new Date(F.created_at).toLocaleString()})]})]}),e.jsx(B,{type:"info",showIcon:!0,message:t.successTip}),e.jsxs(b,{children:[e.jsx(d,{onClick:()=>a(-1),children:t.backToDoc}),e.jsx(d,{onClick:()=>Me(null),children:t.submitAnother})]})]})}):e.jsxs(e.Fragment,{children:[ue&&L&&!G&&e.jsx(B,{type:"warning",showIcon:!0,style:{marginTop:16},message:t.draftFound,description:t.draftFoundDesc.replace("{time}",ce(L.updated_at)),action:e.jsxs(b,{direction:"vertical",children:[e.jsx(d,{size:"small",type:"primary",onClick:et,children:t.draftUse}),e.jsx(d,{size:"small",onClick:Ve,children:t.draftDiscard})]})}),e.jsx(W,{style:{marginTop:16},children:G?e.jsx("div",{style:{textAlign:"center",padding:32},children:e.jsx(dt,{})}):e.jsxs(b,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(c,{type:"secondary",children:t.titleLabel}),e.jsx(le,{value:u,onChange:s=>T(s.target.value)})]}),e.jsx("div",{children:e.jsxs(b,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsxs(N,{gutter:[12,12],align:"middle",children:[e.jsxs(O,{xs:24,md:16,children:[e.jsx(c,{type:"secondary",children:t.templateInsertLabel}),e.jsx($t,{style:{width:"100%"},placeholder:t.templateSelectPlaceholder,options:fe.map(s=>({value:s.id,label:s.title})),onSelect:s=>nt(s),disabled:!fe.length})]}),e.jsxs(O,{xs:24,md:8,children:[e.jsx(c,{type:"secondary",style:{display:"block"},children:t.templateManageLabel}),e.jsx(d,{onClick:()=>a("/operit-submission-center"),children:t.templateManageButton})]})]}),e.jsxs(N,{gutter:[12,12],align:"middle",children:[e.jsxs(O,{xs:24,md:12,children:[e.jsx(c,{type:"secondary",children:t.editorModeLabel}),e.jsx("div",{children:e.jsx(Ke,{value:re,options:[{label:t.editorModeVisual,value:"visual"},{label:t.editorModeMarkdown,value:"markdown"}],onChange:s=>Re(s)})})]}),e.jsxs(O,{xs:24,md:12,children:[e.jsx(c,{type:"secondary",children:t.viewModeLabel}),e.jsx("div",{children:e.jsx(Ke,{value:se,options:[{label:t.viewModeEdit,value:"edit"},{label:t.viewModeSplit,value:"split"},{label:t.viewModePreview,value:"preview"}],onChange:s=>Be(s)})})]})]}),e.jsx(c,{type:"secondary",children:t.contentLabel}),e.jsx(hn,{ref:K,value:y,onChange:D,placeholder:t.contentPlaceholder,mode:re,view:se,fontSize:xe,labels:{toolbarBold:t.toolbarBold,toolbarItalic:t.toolbarItalic,toolbarStrike:t.toolbarStrike,toolbarH1:t.toolbarH1,toolbarH2:t.toolbarH2,toolbarH3:t.toolbarH3,toolbarQuote:t.toolbarQuote,toolbarCode:t.toolbarCode,toolbarCodeBlock:t.toolbarCodeBlock,toolbarList:t.toolbarList,toolbarOrdered:t.toolbarOrdered,toolbarChecklist:t.toolbarChecklist,toolbarLink:t.toolbarLink,toolbarImage:t.toolbarImage,previewEmpty:t.previewEmpty}})]})}),e.jsxs(N,{gutter:[16,16],children:[e.jsxs(O,{xs:24,md:12,children:[e.jsx(c,{type:"secondary",children:t.authorLabel}),e.jsx(le,{value:l,onChange:s=>x(s.target.value),placeholder:t.authorPlaceholder})]}),e.jsxs(O,{xs:24,md:12,children:[e.jsx(c,{type:"secondary",children:t.emailLabel}),e.jsx(le,{value:m,onChange:s=>f(s.target.value),placeholder:t.emailPlaceholder})]})]}),e.jsxs("div",{children:[e.jsx(c,{type:"secondary",children:t.turnstileLabel}),e.jsx("div",{style:{marginTop:8},children:_?e.jsx(ft,{siteKey:_,onVerify:Xe,onExpire:Ze},ne):e.jsx(B,{type:"warning",message:t.turnstileMissing,showIcon:!0})})]}),A&&e.jsx(B,{type:"error",showIcon:!0,message:t.errorTitle,description:A}),e.jsxs(b,{children:[e.jsx(d,{onClick:()=>a(-1),children:t.back}),e.jsx(d,{type:"primary",loading:J,onClick:rt,children:t.submitButton})]})]})}),e.jsx(W,{style:{marginTop:16},children:e.jsxs(b,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(oe,{level:4,style:{margin:0},children:t.draftTitle}),me?e.jsx(c,{type:"secondary",children:t.draftSavedAt.replace("{time}",ce(me))}):e.jsx(c,{type:"secondary",children:t.draftEmpty}),e.jsxs(b,{children:[e.jsx(d,{onClick:()=>ve(!0),disabled:!be,children:t.draftSave}),e.jsx(d,{onClick:Ve,disabled:!me&&!L,children:t.draftClear})]})]})})]}),e.jsx(W,{style:{marginTop:16},children:e.jsxs(b,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(oe,{level:4,style:{margin:0},children:t.historyTitle}),pe.length?e.jsx(ye,{size:"small",dataSource:pe,renderItem:s=>e.jsx(ye.Item,{actions:[e.jsx(we,{children:s.language},`${s.id}-lang`),e.jsx(c,{code:!0,children:s.id},`${s.id}-id`)],children:e.jsx(ye.Item.Meta,{title:s.title||t.historyUntitled,description:e.jsxs(b,{direction:"vertical",size:0,children:[e.jsx(c,{type:"secondary",children:s.target_path}),e.jsxs(c,{type:"secondary",children:[s.status," | ",ce(s.created_at)]})]})})})}):e.jsx(c,{type:"secondary",children:t.historyEmpty}),e.jsx(b,{children:e.jsx(d,{onClick:tt,disabled:!pe.length,children:t.historyClear})})]})})]})})};export{Cn as default};
