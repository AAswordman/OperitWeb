# AI权限控制

Operit AI 赋予了 AI 强大的工具使用能力，使其能够与您的设备和各种软件进行交互。为了确保您对 AI 的行为有完全的控制权，我们设计了一套灵活的权限管理系统。您可以根据自己的需求，精细地调整 AI 执行操作前是否需要您的许可。

## 版本说明

权限系统在 1.6.1 版本进行了重大更新。本文档将分别介绍 1.6.1 之前和之后的权限系统。

---

## 1.6.1 之前的权限系统（类别权限）

### 快捷入口：全局自动批准

在对话界面，我们提供了一个方便的快捷开关，用于控制全局的工具权限。

![全局自动批准开关](</manuals/assets/permission/image.png>)

如上图所示，您可以直接在对话设置中找到"自动批准"开关。

-   **开启状态**：AI将根据您在设置中配置的权限等级自动执行工具，无需每次都询问。
-   **关闭状态**：AI在执行任何工具操作前，都会向您请求许可。

这个开关为您提供了一种快速切换全局权限模式的方式，非常适合在不同使用场景下进行调整。

### 详细权限设置

如果您需要更精细化的权限管理，可以进入应用的"设置"页面进行详细配置。

1.  **进入设置**：在主菜单中找到并点击"设置"。
2.  **找到权限设置**：在设置页面中，找到"数据和权限"板块，然后点击"工具权限设置"。

![工具权限设置入口](</manuals/assets/permission/image2.png>)

### 配置权限等级

在"工具权限"页面，您可以分别配置"全局权限"和"系统操作权限"。

![权限等级配置](</manuals/assets/permission/image3.png>)

#### 全局权限开关

此设置控制所有非系统级别的 AI 工具权限。

-   **允许 (自动执行, 不询问)**：AI将自动执行所有工具操作，不会征求您的同意。这是最高权限，请在您完全信任当前 AI 配置时使用。
-   **警惕 (仅对危险操作询问)**：AI 会自动执行大部分操作，但对于可能修改或删除文件、执行高风险命令等危险操作，会弹出确认请求。
-   **询问 (总是询问)**：AI 在使用任何工具前，都会向您请求授权。这是最安全的模式。
-   **禁止 (不允许执行)**：完全禁止 AI 使用任何工具。

#### 系统操作权限

此设置专门针对更敏感的系统级操作，例如修改系统设置、安装/卸载应用等。您可以为其设置独立的权限等级，以实现更严格的控制。

#### 权限优先级逻辑

为了让您更灵活地控制AI，权限系统采用了一种分层逻辑。**全局权限设置拥有最高优先级，可以看作是总开关。**

1.  **当全局权限设为"询问(总是询问)"或"禁止(不允许执行)"时**：
    *   这将成为一个强制性的全局规则。所有工具，无论其具体类别权限如何设置，都将统一被要求"询问"或被"禁止"。

2.  **当全局权限设为"允许(自动执行)"或"警惕(仅对危险操作询问)"时**：
    *   总开关被视为"开启"，此时系统会进一步检查具体操作所属类别的权限设置（例如"系统操作权限"）。
    *   最终是否执行、询问或禁止，将由这个**更具体的小类权限设置**来决定。

**举个例子：**

假设您进行如下配置：

*   **全局权限开关** -> `允许 (自动执行, 不询问)`
*   **系统操作权限** -> `询问 (总是询问)`

当AI需要执行一项**普通操作**（不属于系统操作）时，它会因为符合全局的"允许"规则而自动执行。
但是，当AI需要**修改系统设置**时，它会匹配到"系统操作权限"这条更具体的规则，因此会**弹出对话框向您询问**，而不是自动执行。

---

## 1.6.1 及之后的权限系统（全局权限 + 单个工具权限）

从 1.6.1 版本开始，权限系统进行了重大改进，从"全局权限 + 类别权限"改为"全局权限 + 单个工具权限"，让您能够更精细地控制每个工具的执行权限。

### 快捷入口：全局自动批准

在对话界面，我们提供了一个方便的快捷开关，用于控制全局的工具权限。

![全局自动批准开关](</manuals/assets/permission/image.png>)

如上图所示，您可以直接在对话设置中找到"自动批准"开关。

-   **开启状态**：AI将根据您在设置中配置的权限等级自动执行工具，无需每次都询问。
-   **关闭状态**：AI在执行任何工具操作前，都会向您请求许可。

这个开关为您提供了一种快速切换全局权限模式的方式，非常适合在不同使用场景下进行调整。

### 详细权限设置

如果您需要更精细化的权限管理，可以进入应用的"设置"页面进行详细配置。

1.  **进入设置**：在主菜单中找到并点击"设置"。
2.  **找到权限设置**：在设置页面中，找到"数据和权限"板块，然后点击"工具权限设置"。

![工具权限设置入口](</manuals/assets/permission/image2.png>)

### 工具权限管理界面

在"工具权限"页面，您可以配置全局权限开关，并为单个工具设置例外规则。

![工具权限管理界面](</manuals/assets/permission/60a4d8ccc51c010cedd98dbdf5fd842d.jpg>)

#### 全局权限开关

全局权限开关作为主控制，可以覆盖单个工具权限。您可以选择以下四种模式：

-   **允许**：AI将自动执行所有工具操作，不会征求您的同意。这是最高权限，请在您完全信任当前 AI 配置时使用。
-   **谨慎**：AI 会自动执行大部分操作，但对于可能修改或删除文件、执行高风险命令等危险操作，会弹出确认请求。
-   **询问**：AI 在使用任何工具前，都会向您请求授权。这是最安全的模式，也是默认模式。
-   **禁止**：完全禁止 AI 使用任何工具。

**默认情况下，所有工具都需要您询问。您可以在下面添加例外。**

#### 单个工具权限设置

在全局权限开关下方，您可以为特定工具设置例外规则。系统提供了多个权限类别，每个类别下可以添加允许自动执行的工具：

-   **允许列表**：这些工具将自动运行，无需询问。您可以点击右侧的"+"按钮添加工具到此列表，也可以点击工具右侧的"X"按钮将其移除。

通过这种方式，您可以实现更精细的权限控制：
-   如果全局权限设为"询问"，但您希望某些常用工具（如 `read_file`、`list_files`）自动执行，可以将它们添加到"允许"列表中。
-   如果全局权限设为"允许"，但您希望某些敏感工具（如 `delete_file`）总是询问，可以保持它们不在"允许"列表中。

### 权限请求对话框

当 AI 需要执行某个工具，但该工具不在允许列表中时，系统会弹出权限请求对话框。

![权限请求对话框](</manuals/assets/permission/a3d6dceea288c5ba84b6b4c78c446caa.jpg>)

权限请求对话框会显示以下信息：

-   **请求的操作**：AI 想要执行的具体操作（如使用工具包、执行文件操作等）
-   **使用的工具**：具体使用的工具名称
-   **参数详情**：工具执行所需的参数信息

您可以选择：

-   **拒绝**：拒绝此次操作请求
-   **允许**：允许此次操作执行
-   **以后都允许**：允许此次操作，并将该工具添加到"允许"列表中，以后将自动执行，不再询问

**提示：** 您可以在设置中随时更改权限设置。

### 权限优先级逻辑

新的权限系统采用以下优先级逻辑：

1.  **全局权限开关**：作为主控制，拥有最高优先级
    -   当全局权限设为"询问"或"禁止"时，所有工具都将遵循此规则（除非在允许列表中的工具，在"询问"模式下仍会询问）
    -   当全局权限设为"允许"或"谨慎"时，系统会检查单个工具的权限设置

2.  **单个工具权限**：在全局权限允许的情况下，单个工具的权限设置会生效
    -   在"允许"列表中的工具将自动执行
    -   不在"允许"列表中的工具将弹出权限请求对话框

**举个例子：**

假设您进行如下配置：

*   **全局权限开关** -> `询问`
*   **允许列表** -> `read_file`, `list_files`, `query_memory`

当AI需要执行 `read_file` 时，由于它在允许列表中，将自动执行。
当AI需要执行 `delete_file` 时，由于它不在允许列表中，会弹出权限请求对话框询问您的许可。

通过这套权限系统，您可以在便利性与安全性之间找到最适合自己的平衡点。
